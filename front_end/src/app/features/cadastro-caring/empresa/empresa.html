<app-page-header 
  [title]="'Cadastro Caring — Empresas'" 
  [subtitle]="'Selecione a clínica para visualizar os dados'" 
  [icon]="'building'">
</app-page-header>

<div class="empresa-card">
  <div class="toolbar">
    <label>Pesquisar:</label>
    <ui-input [(ngModel)]="search" name="search" placeholder="Nome, CNPJ, Código, Telefone ou Número"></ui-input>
    <button class="btn-primary" (click)="abrirNovaEmpresa()">Nova Empresa</button>
    <span class="selecionada" *ngIf="selected">Selecionada: <strong>{{selected!.nome}}</strong> ({{selected!.codigo}})</span>
  </div>

  <div class="selection-card">
    <div class="selection-header">Escolha a unidade que deseja acessar</div>
    <div class="selection-body">
      <label>Unidade *</label>
      <select class="form-select" [(ngModel)]="selectedCodigo">
        <option value="">Selecione...</option>
        <option *ngFor="let c of clinicas" [value]="c.codigo">{{c.nome}}</option>
      </select>
    </div>
    <div class="selection-actions">
      <button class="btn-access" [disabled]="!selectedCodigo" (click)="acessarSelecionada()">Acessar</button>
      <button class="btn-secondary" [disabled]="!selectedCodigo" (click)="abrirEdicaoSelecionada()">Editar</button>
    </div>
  </div>

  <div *ngIf="showForm" class="modal-backdrop" (click)="cancelarNovaClinica()"></div>
  <div *ngIf="showForm" class="modal-card" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Nova Empresa</h3>
      <button class="modal-close" (click)="cancelarNovaClinica()">×</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>Nome *</label>
          <ui-input [(ngModel)]="novaClinica.nome" name="nome"></ui-input>
        </div>
        <div class="form-group">
          <label>CNPJ *</label>
          <ui-input [(ngModel)]="novaClinica.cnpj" (ngModelChange)="onCnpjInput($event)" name="cnpj" placeholder="00.000.000/0000-00"></ui-input>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Código Empresa *</label>
          <ui-input [(ngModel)]="novaClinica.codigo" name="codigo"></ui-input>
        </div>
        <div class="form-group">
          <label>Número Empresa *</label>
          <ui-input [(ngModel)]="novaClinica.numeroEmpresa" name="numeroEmpresa"></ui-input>
        </div>
        <div class="form-group">
          <label>Cidade *</label>
          <ui-input [(ngModel)]="novaClinica.cidade" name="cidade"></ui-input>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>UF *</label>
          <select class="form-select" [(ngModel)]="novaClinica.uf" name="uf">
            <option value="">Selecione</option>
            <option *ngFor="let u of ufs" [value]="u">{{u}}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Telefone *</label>
          <ui-input [(ngModel)]="novaClinica.telefone" (ngModelChange)="onTelefoneInput($event)" name="telefone" placeholder="(00) 00000-0000"></ui-input>
        </div>
        <div class="form-group"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="cancelarNovaClinica()">Cancelar</button>
      <button class="btn-primary" (click)="salvarNovaClinica()">Salvar</button>
    </div>
  </div>

  <table class="empresa-table">
    <thead>
      <tr>
        <th>Nome</th>
        <th>CNPJ</th>
        <th>Código Empresa</th>
        <th>Número Empresa</th>
        <th>Cidade</th>
        <th>UF</th>
        <th>Telefone</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let c of filtered">
        <td>{{c.nome}}</td>
        <td>{{c.cnpj}}</td>
        <td>{{c.codigo}}</td>
        <td>{{c.numeroEmpresa || ''}}</td>
        <td>{{c.cidade}}</td>
        <td>{{c.uf}}</td>
        <td>{{c.telefone || ''}}</td>
        <td class="actions">
          <button class="btn-secondary" (click)="abrirEdicaoClinica(c)">Editar</button>
        </td>
      </tr>
      <tr *ngIf="filtered.length===0"><td colspan="8" class="empty">Nenhuma clínica encontrada</td></tr>
    </tbody>
  </table>

  <!-- Modal de Edição -->
  <div *ngIf="showEdit" class="modal-backdrop" (click)="cancelarEdicaoClinica()"></div>
  <div *ngIf="showEdit" class="modal-card" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Editar Empresa</h3>
      <button class="modal-close" (click)="cancelarEdicaoClinica()">×</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>Nome *</label>
          <ui-input [(ngModel)]="edicaoClinica.nome" name="ed_nome"></ui-input>
        </div>
        <div class="form-group">
          <label>CNPJ *</label>
          <ui-input [(ngModel)]="edicaoClinica.cnpj" (ngModelChange)="onCnpjEdicao($event)" name="ed_cnpj" placeholder="00.000.000/0000-00"></ui-input>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Código Empresa *</label>
          <ui-input [(ngModel)]="edicaoClinica.codigo" name="ed_codigo"></ui-input>
        </div>
        <div class="form-group">
          <label>Número Empresa *</label>
          <ui-input [(ngModel)]="edicaoClinica.numeroEmpresa" name="ed_numeroEmpresa"></ui-input>
        </div>
        <div class="form-group">
          <label>Cidade *</label>
          <ui-input [(ngModel)]="edicaoClinica.cidade" name="ed_cidade"></ui-input>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>UF *</label>
          <select class="form-select" [(ngModel)]="edicaoClinica.uf" name="ed_uf">
            <option value="">Selecione</option>
            <option *ngFor="let u of ufs" [value]="u">{{u}}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Telefone *</label>
          <ui-input [(ngModel)]="edicaoClinica.telefone" (ngModelChange)="onTelefoneEdicao($event)" name="ed_telefone" placeholder="(00) 00000-0000"></ui-input>
        </div>
        <div class="form-group"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="cancelarEdicaoClinica()">Cancelar</button>
      <button class="btn-primary" (click)="salvarEdicaoClinica()">Salvar</button>
    </div>
  </div>
</div>
