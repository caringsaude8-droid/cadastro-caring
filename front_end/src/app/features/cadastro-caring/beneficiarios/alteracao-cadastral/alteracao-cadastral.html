

<div class="empresa-info-bar" *ngIf="empresaSelecionada">
  <span>Empresa selecionada: <b>{{ empresaSelecionada.nome || empresaSelecionada.razaoSocial || empresaSelecionada.fantasia }}</b></span>
</div>

<app-page-header 
  [title]="'Cadastro Caring — Alteração Cadastral'" 
  [subtitle]="'Atualize os dados do beneficiário e salve as mudanças'" 
  [icon]="'users'">
</app-page-header>



<div class="form-card">
  <form class="benef-form" (ngSubmit)="salvar()">
    <div class="section-title-bar">Dados do Beneficiário</div>
    
    <!-- Tipo de Motivo -->
    <div class="form-row">
      <div class="form-group half">
        <label>Tipo de Movimentação</label>
        <select [(ngModel)]="form.tipoMotivo" name="tipoMotivo" class="form-select" required>
          <option value="" disabled>Selecione o tipo de movimentação</option>
          <option *ngFor="let tipo of tiposMotivo" [value]="tipo.value">{{tipo.label}}</option>
        </select>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group third">
        <label>Nome Segurado</label>
        <ui-input [(ngModel)]="form.nomeSegurado" name="nomeSegurado"></ui-input>
      </div>
      <div class="form-group third">
        <label>CPF</label>
        <ui-input [(ngModel)]="form.cpf" name="cpf" placeholder="000.000.000-00"></ui-input>
      </div>
      <div class="form-group third">
        <label>Data Nascimento</label>
        <ui-input [(ngModel)]="form.dataNascimento" name="dataNascimento" placeholder="dd/mm/aaaa"></ui-input>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group third">
        <label>Sexo</label>
        <select class="form-select" [(ngModel)]="form.sexo" name="sexo">
          <option value="">Selecione</option>
          <option *ngFor="let s of sexos" [value]="s.value">{{s.label}}</option>
        </select>
      </div>
      <div class="form-group third">
        <label>Estado Civil</label>
        <select class="form-select" [(ngModel)]="form.estadoCivil" name="estadoCivil">
          <option value="">Selecione</option>
          <option *ngFor="let e of estadosCivis" [value]="e.value">{{e.label}}</option>
        </select>
      </div>
      <div class="form-group third">
        <label>Plano/Prod</label>
        <select class="form-select" [(ngModel)]="form.planoProd" name="planoProd">
          <option value="">Selecione</option>
          <option *ngFor="let p of planos" [value]="p.value">{{p.label}}</option>
        </select>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group third">
        <label>Data Inclusão</label>
        <ui-input [(ngModel)]="form.dataInclusao" name="dataInclusao" placeholder="dd/mm/aaaa"></ui-input>
      </div>
      <div class="form-group third">
        <label>Data Exclusão</label>
        <ui-input [(ngModel)]="form.dataExclusao" name="dataExclusao" placeholder="dd/mm/aaaa"></ui-input>
      </div>
      <div class="form-group third">
        <label>Dependência</label>
        <ui-input [(ngModel)]="form.dependencia" name="dependencia"></ui-input>
      </div>
    </div>

    <div class="section-title-bar">Endereço</div>
    <div class="form-row">
      <div class="form-group third">
        <label>Cidade</label>
        <ui-input [(ngModel)]="form.cidade" name="cidade"></ui-input>
      </div>
      <div class="form-group third">
        <label>UF</label>
        <select class="form-select" [(ngModel)]="form.uf" name="uf">
          <option value="">UF</option>
          <option *ngFor="let u of ufs" [value]="u">{{u}}</option>
        </select>
      </div>
      <div class="form-group third">
        <label>Admissão</label>
        <ui-input [(ngModel)]="form.admissao" name="admissao" placeholder="dd/mm/aaaa"></ui-input>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group third">
        <label>Nome da Mãe</label>
        <ui-input [(ngModel)]="form.nomeMae" name="nomeMae"></ui-input>
      </div>
      <div class="form-group third">
        <label>Endereço</label>
        <ui-input [(ngModel)]="form.endereco" name="endereco"></ui-input>
      </div>
      <div class="form-group third">
        <label>Número</label>
        <ui-input [(ngModel)]="form.numero" name="numero"></ui-input>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group third">
        <label>Complemento</label>
        <ui-input [(ngModel)]="form.complemento" name="complemento"></ui-input>
      </div>
      <div class="form-group third">
        <label>Bairro</label>
        <ui-input [(ngModel)]="form.bairro" name="bairro"></ui-input>
      </div>
      <div class="form-group third">
        <label>CEP</label>
        <ui-input [(ngModel)]="form.cep" name="cep" placeholder="00000-000"></ui-input>
      </div>
    </div>

    <div class="section-title-bar">Contato</div>
    <div class="form-row">
      <div class="form-group third">
        <label>Celular (com DDD)</label>
          <ui-input [(ngModel)]="celularFormatado" name="celular" placeholder="(11) 99999-9999"></ui-input>
      </div>
      <div class="form-group third">
        <label>E-mail</label>
        <ui-input [(ngModel)]="form.email" name="email"></ui-input>
      </div>
      <div class="form-group third"></div>
    </div>

    <div class="form-row">
      <div class="form-group third">
        <label>Receber comunicação por email?</label>
        <select class="form-select" [(ngModel)]="form.receberComunicacaoEmail" name="receberComunicacaoEmail">
          <option value="nao">Não</option>
          <option value="sim">Sim</option>
        </select>
      </div>
      <div class="form-group third">
        <label>Matrícula</label>
        <ui-input [(ngModel)]="form.matricula" name="matricula"></ui-input>
      </div>
      <div class="form-group third"></div>
    </div>

    <div class="section-title-bar">Dados Complementares</div>
    <div class="form-row">
      <div class="form-group third">
        <label>Data Casamento</label>
        <ui-input type="date" [(ngModel)]="form.dataCasamento" name="dataCasamento"></ui-input>
      </div>
      <div class="form-group third">
        <label>Indicador Pessoa Trans</label>
        <select class="form-select" [(ngModel)]="form.indicadorPessoaTrans" name="indicadorPessoaTrans">
          <option value="nao">Não</option>
          <option value="sim">Sim</option>
        </select>
      </div>
      <div class="form-group third">
        <label>Nome Social</label>
        <ui-input [(ngModel)]="form.nomeSocial" name="nomeSocial"></ui-input>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group third">
        <label>Identidade de Gênero</label>
        <select class="form-select" [(ngModel)]="form.identidadeGenero" name="identidadeGenero">
          <option value="">Selecione</option>
          <option *ngFor="let g of generos" [value]="g.value">{{g.label}}</option>
        </select>
      </div>
      <div class="form-group third"></div>
      <div class="form-group third"></div>
    </div>

    <div class="section-title-bar">Anexos</div>
    <div class="form-row">
      <div class="form-group third">
        <label>Tipo de Documento</label>
        <select class="form-select" [(ngModel)]="docTipo" name="docTipo">
          <option value="">Selecione</option>
          <option *ngFor="let t of docTipos" [value]="t">{{t}}</option>
        </select>
      </div>
      <div class="form-group third">
        <label>Arquivo</label>
        <input type="file" (change)="onFileSelected($event)">
      </div>
      <div class="form-group third"></div>
    </div>

    <div class="attachments">
      <table class="attachments-table">
        <thead>
          <tr>
            <th>Tipo</th>
            <th>Arquivo</th>
            <th>Tamanho</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let a of anexos; let i = index">
            <td>{{a.tipo}}</td>
            <td>{{a.nome}}</td>
            <td>{{(a.size/1024) | number:'1.0-0'}} KB</td>
            <td class="file-actions">
              <button type="button" class="btn-secondary" (click)="baixarAnexo(i)">Baixar</button>
              <button type="button" class="btn-danger" (click)="removerAnexo(i)">Remover</button>
            </td>
          </tr>
          <tr *ngIf="anexos.length===0"><td colspan="4" class="empty">Nenhum anexo adicionado</td></tr>
        </tbody>
      </table>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn-primary">Salvar</button>
      <button type="button" class="btn-secondary" (click)="cancelar()">Cancelar</button>
    </div>
  </form>
</div>
