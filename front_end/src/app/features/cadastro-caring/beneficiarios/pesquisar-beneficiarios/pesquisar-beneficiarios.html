<app-page-header 
  [title]="'Cadastro Caring â€” AlteraÃ§Ã£o Cadastral'" 
  [subtitle]="'Filtre o beneficiÃ¡rio e abra detalhes para alterar'" 
  [icon]="'users'">
</app-page-header>

<div class="search-container">
  <div class="search-bar">
    <span class="title">Pesquisa de beneficiÃ¡rios:</span>
    <div class="filters">
      <label>Nome:</label>
      <ui-input [(ngModel)]="nome" name="nome" placeholder=""></ui-input>
      <label>MatrÃ­cula:</label>
      <ui-input [(ngModel)]="matricula" name="matricula" placeholder=""></ui-input>
      <label>MatrÃ­cula titular:</label>
      <ui-input [(ngModel)]="matriculaTitular" name="matriculaTitular" placeholder=""></ui-input>
      <button class="btn-primary" (click)="goTo(1)">Pesquisar</button>
    </div>
  </div>

  <div class="table-wrapper">
    <table class="result-table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>CPF</th>
          <th>Nascim.</th>
          <th>Data InclusÃ£o</th>
          <th>Data ExclusÃ£o</th>
          <th>Tipo DependÃªncia</th>
          <th>AcomodaÃ§Ã£o</th>
          <th>MatrÃ­cula</th>
          <th>Status</th>
          <th>AÃ§Ãµes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of paged">
          <td>{{row.nome}}</td>
          <td>{{row.cpf}}</td>
          <td>{{row.nascimento}}</td>
          <td>{{formatDateBR(row.data_inclusao)}}</td>
          <td>{{row.data_exclusao ? formatDateBR(row.data_exclusao) : ''}}</td>
          <td>{{row.tipo_dependencia}}</td>
          <td>{{row.acomodacao}}</td>
          <td>{{row.matricula_beneficiario}}</td>
          <td>{{statusOf(row)}}</td>
          <td class="actions">
            <button class="btn-icon" (click)="openDetails(row)" title="Detalhes">ðŸ”Ž</button>
          </td>
        </tr>
        <tr *ngIf="paged.length === 0">
          <td colspan="10" class="empty">Nenhum beneficiÃ¡rio encontrado.</td>
        </tr>
      </tbody>
    </table>

    <div class="pagination">
      <button (click)="goTo(1)">Â«Â«</button>
      <button (click)="goTo(page - 1)">Â«</button>
      <span class="pages">
        <button *ngFor="let p of [].constructor(totalPages); let i = index" [class.active]="page === i + 1" (click)="goTo(i + 1)">{{i + 1}}</button>
      </span>
      <button (click)="goTo(page + 1)">Â»</button>
      <button (click)="goTo(totalPages)">Â»Â»</button>
    </div>
  </div>
</div>

<!-- Card de Detalhes -->
<div *ngIf="showDetails" class="modal-backdrop" (click)="closeDetails()"></div>
<div *ngIf="showDetails" class="modal-card">
  <div class="modal-header">
    <h3>Dados do BeneficiÃ¡rio</h3>
    <button class="modal-close" (click)="closeDetails()">Ã—</button>
  </div>
  <div class="modal-body">
    <div class="detail-grid" *ngIf="selectedRow as r">
      <div class="item"><span class="label">Nome:</span><span class="value">{{r.nome}}</span></div>
      <div class="item"><span class="label">CPF:</span><span class="value">{{r.cpf}}</span></div>
      <div class="item"><span class="label">Nascimento:</span><span class="value">{{r.nascimento}}</span></div>
      <div class="item"><span class="label">InclusÃ£o:</span><span class="value">{{formatDateBR(r.data_inclusao)}}</span></div>
      <div class="item"><span class="label">ExclusÃ£o:</span><span class="value">{{r.data_exclusao ? formatDateBR(r.data_exclusao) : 'â€”'}}</span></div>
      <div class="item"><span class="label">Tipo DependÃªncia:</span><span class="value">{{r.tipo_dependencia}}</span></div>
      <div class="item"><span class="label">AcomodaÃ§Ã£o:</span><span class="value">{{r.acomodacao}}</span></div>
      <div class="item"><span class="label">MatrÃ­cula:</span><span class="value">{{r.matricula_beneficiario}}</span></div>
      <div class="item"><span class="label">MatrÃ­cula Titular:</span><span class="value">{{r.matricula_titular}}</span></div>
      <div class="item"><span class="label">Status:</span><span class="value">{{statusOf(r)}}</span></div>
    </div>

    <div class="section-subtitle">EndereÃ§o</div>
    <div class="detail-grid" *ngIf="selectedRow as r">
      <div class="item"><span class="label">EndereÃ§o:</span><span class="value">{{r.endereco || 'â€”'}}</span></div>
      <div class="item"><span class="label">NÃºmero:</span><span class="value">{{r.numero || 'â€”'}}</span></div>
      <div class="item"><span class="label">Complemento:</span><span class="value">{{r.complemento || 'â€”'}}</span></div>
      <div class="item"><span class="label">Bairro:</span><span class="value">{{r.bairro || 'â€”'}}</span></div>
      <div class="item"><span class="label">CEP:</span><span class="value">{{r.cep || 'â€”'}}</span></div>
      <div class="item"><span class="label">LotaÃ§Ã£o do Func.:</span><span class="value">{{r.lotacaoFuncionario || 'â€”'}}</span></div>
    </div>

    <div class="section-subtitle">Contato</div>
    <div class="detail-grid" *ngIf="selectedRow as r">
      <div class="item"><span class="label">DDD Celular:</span><span class="value">{{r.dddCelular || 'â€”'}}</span></div>
      <div class="item"><span class="label">Celular:</span><span class="value">{{r.celular || 'â€”'}}</span></div>
      <div class="item"><span class="label">E-mail:</span><span class="value">{{r.email || 'â€”'}}</span></div>
      <div class="item"><span class="label">Receber por e-mail:</span><span class="value">{{r.receberComunicacaoEmail || 'â€”'}}</span></div>
    </div>

    <div class="section-subtitle">Dados Complementares</div>
    <div class="detail-grid" *ngIf="selectedRow as r">
      <div class="item"><span class="label">AdmissÃ£o:</span><span class="value">{{r.admissao || 'â€”'}}</span></div>
      <div class="item"><span class="label">Nome da MÃ£e:</span><span class="value">{{r.nomeMae || 'â€”'}}</span></div>
      <div class="item"><span class="label">DeclaraÃ§Ã£o Nascido Vivo:</span><span class="value">{{r.declaracaoNascidoVivo || 'â€”'}}</span></div>
      <div class="item"><span class="label">CNS:</span><span class="value">{{r.cns || 'â€”'}}</span></div>
      <div class="item"><span class="label">Identidade de GÃªnero:</span><span class="value">{{r.identidadeGenero || 'â€”'}}</span></div>
      <div class="item"><span class="label">Nome Social:</span><span class="value">{{r.nomeSocial || 'â€”'}}</span></div>
      <div class="item"><span class="label">Indicador Pessoa Trans:</span><span class="value">{{r.indicadorPessoaTrans || 'â€”'}}</span></div>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn-secondary" (click)="openExclusao()">ExclusÃ£o</button>
    <button class="btn-primary" (click)="goAlteracaoFromDetails()">AlteraÃ§Ã£o de Cadastro</button>
    <button class="btn-info" (click)="gerarCarterinha()">Gerar Carterinha Virtual</button>
  </div>
</div>

<!-- Card de ExclusÃ£o -->
<div *ngIf="showExclusao" class="modal-backdrop" (click)="closeExclusao()"></div>
<div *ngIf="showExclusao" class="modal-card">
  <div class="modal-header">
    <h3>ExclusÃ£o de BeneficiÃ¡rio</h3>
    <button class="modal-close" (click)="closeExclusao()">Ã—</button>
  </div>
  <div class="modal-body">
    <div class="exclusion-grid">
      <div class="field">
        <label>Motivo</label>
        <select [(ngModel)]="exMotivo" name="ex_motivo" class="select-md">
          <option value="">Selecione</option>
          <option value="rescisao">RescisÃ£o</option>
          <option value="falecimento">Falecimento</option>
          <option value="transferencia">TransferÃªncia</option>
          <option value="outro">Outro</option>
        </select>
      </div>
      <div class="field">
        <label>Data da ExclusÃ£o</label>
        <ui-input type="date" [(ngModel)]="exData" name="ex_data"></ui-input>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn-secondary" (click)="closeExclusao()">Cancelar</button>
    <button class="btn-primary" (click)="confirmarExclusao()">Confirmar ExclusÃ£o</button>
  </div>
</div>
